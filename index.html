<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Science Institute - Premier Coaching for Life Sciences</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" href="data:image/png;base64,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" type="image/png">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <!-- Firebase Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, sendPasswordResetEmail, updateProfile, sendEmailVerification } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Make functions globally available
        window.showPage = showPage;
        window.getCartCount = getCartCount;
        window.addToCart = addToCart;
        window.clearCart = clearCart;
        window.showToast = showToast;

        // --- Firebase Setup ---
        // Use global variables provided by the environment
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const storage = getStorage(app);
        const db = getFirestore(app);
        // Enable detailed logging for Firestore
        setLogLevel('debug');

        let currentUser = null;

        // --- App Navigation ---
        function showPage(pageId) {
            // Hide all page content
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            // Show the requested page
            const activePage = document.getElementById(pageId);
            if (activePage) {
                activePage.classList.remove('hidden');
            } else {
                // Fallback to home if page not found
                document.getElementById('page-home').classList.remove('hidden');
            }
            // Scroll to top
            window.scrollTo(0, 0);

            // Special handling for cart and checkout
            if(pageId === 'page-cart') {
                renderCart();
            }
            if(pageId === 'page-checkout') {
                renderCheckoutSummary();
            }
        }

        // --- Cart Logic (from cart.js) ---
        const CART_KEY = 'esi_cart';

        function getCart() {
            return JSON.parse(localStorage.getItem(CART_KEY)) || [];
        }

        function saveCart(cart) {
            localStorage.setItem(CART_KEY, JSON.stringify(cart));
            window.dispatchEvent(new CustomEvent('cartUpdated'));
        }

        function addToCart(item) {
            const cart = getCart();
            const existingItemIndex = cart.findIndex(i => i.id === item.id);

            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += item.quantity;
            } else {
                cart.push(item);
            }
            saveCart(cart);
        }

        function removeFromCart(itemId) {
            let cart = getCart();
            cart = cart.filter(item => item.id !== itemId);
            saveCart(cart);
        }

        function updateQuantity(itemId, quantity) {
            const cart = getCart();
            const itemIndex = cart.findIndex(i => i.id === itemId);

            if (itemIndex > -1) {
                if (quantity <= 0) {
                    cart.splice(itemIndex, 1);
                } else {
                    cart[itemIndex].quantity = quantity;
                }
                saveCart(cart);
            }
        }

        function getCartItems() {
            return getCart();
        }

        function getCartCount() {
            const cart = getCart();
            return cart.reduce((total, item) => total + item.quantity, 0);
        }

        function getCartTotal() {
            const cart = getCart();
            return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        function clearCart() {
            saveCart([]);
        }

        // --- Main App Logic (from app.js) ---
        
        // --- DOM Elements ---
        let mobileMenuButton, mobileMenu, loginBtn, mobileLoginBtn, logoutBtn, userProfile,
            userProfileTrigger, profileDropdown, userDisplayName, userAvatar, userIcon,
            avatarSpinner, avatarUploadInput, verificationStatus, resendVerificationBtn,
            authModal, closeModalBtn, authTitle, authFullNameInput, authEmailInput,
            authMobileInput, authPasswordInput, authActionBtn, authActionText, authSpinner,
            authToggleText, authMessage, fullNameContainer, mobileContainer, passwordField,
            forgotPasswordContainer, forgotPasswordLink, backToLoginContainer, backToLoginLink,
            toast, toastMessage, cartCountBadge, loggedInDropdown, loggedOutDropdown,
            cartContainer, cartTotalEl, checkoutBtn, checkoutSummaryContainer,
            checkoutSubtotal, checkoutTotal, payNowBtn, shippingForm;

        // Function to assign all DOM elements once content is loaded
        function assignDOMElements() {
            mobileMenuButton = document.getElementById('mobile-menu-button');
            mobileMenu = document.getElementById('mobile-menu');
            loginBtn = document.getElementById('login-btn');
            mobileLoginBtn = document.getElementById('mobile-login-btn');
            logoutBtn = document.getElementById('logout-btn');
            userProfile = document.getElementById('user-profile');
            userProfileTrigger = document.getElementById('user-profile-trigger');
            profileDropdown = document.getElementById('profile-dropdown');
            userDisplayName = document.getElementById('user-display-name');
            userAvatar = document.getElementById('user-avatar');
            userIcon = document.getElementById('user-icon');
            avatarSpinner = document.getElementById('avatar-spinner');
            avatarUploadInput = document.getElementById('avatar-upload');
            verificationStatus = document.getElementById('verification-status');
            resendVerificationBtn = document.getElementById('resend-verification-btn');
            loggedInDropdown = document.getElementById('logged-in-dropdown');
            loggedOutDropdown = document.getElementById('logged-out-dropdown');

            // Modal elements
            authModal = document.getElementById('auth-modal');
            closeModalBtn = document.getElementById('close-modal-btn');
            authTitle = document.getElementById('auth-title');
            authFullNameInput = document.getElementById('auth-full-name');
            authEmailInput = document.getElementById('auth-email');
            authMobileInput = document.getElementById('auth-mobile');
            authPasswordInput = document.getElementById('auth-password');
            authActionBtn = document.getElementById('auth-action-btn');
            authActionText = document.getElementById('auth-action-text');
            authSpinner = document.getElementById('auth-spinner');
            authToggleText = document.getElementById('auth-toggle-text');
            authMessage = document.getElementById('auth-message');
            fullNameContainer = document.getElementById('full-name-container');
            mobileContainer = document.getElementById('mobile-container');
            passwordField = document.getElementById('password-container-div');
            forgotPasswordContainer = document.getElementById('forgot-password-container');
            forgotPasswordLink = document.getElementById('forgot-password-link');
            backToLoginContainer = document.getElementById('back-to-login-container');
            backToLoginLink = document.getElementById('back-to-login-link');
            
            // Toast Notification Elements
            toast = document.getElementById('toast-notification');
            toastMessage = document.getElementById('toast-message');

            // Cart Badge
            cartCountBadge = document.getElementById('cart-count-badge');

            // Cart Page Elements
            cartContainer = document.getElementById('cart-items-container');
            cartTotalEl = document.getElementById('cart-total');
            checkoutBtn = document.getElementById('checkout-btn');

            // Checkout Page Elements
            checkoutSummaryContainer = document.getElementById('summary-items-container');
            checkoutSubtotal = document.getElementById('summary-subtotal');
            checkoutTotal = document.getElementById('summary-total');
            payNowBtn = document.getElementById('pay-now-btn');
            shippingForm = document.getElementById('shipping-form');
        }

        let authView = 'login'; // Can be 'login', 'signup', or 'reset'

        // --- UI Logic ---
        function setupUIEventListeners() {
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            const openModal = () => {
                resetModalUI();
                authModal.classList.remove('opacity-0', 'pointer-events-none');
                authModal.querySelector('.modal-content').classList.remove('scale-95');
            };
            
            const closeModal = () => {
                authModal.classList.add('opacity-0', 'pointer-events-none');
                authModal.querySelector('.modal-content').classList.add('scale-95');
            };

            // Login buttons
            loginBtn.addEventListener('click', openModal);
            mobileLoginBtn.addEventListener('click', openModal);
            document.getElementById('profile-login-btn').addEventListener('click', openModal);
            
            // Modal controls
            closeModalBtn.addEventListener('click', closeModal);
            authModal.addEventListener('click', (e) => {
                if (e.target === authModal) {
                    closeModal();
                }
            });

            // Profile Dropdown Logic
            userProfileTrigger.addEventListener('click', (e) => {
                e.stopPropagation();
                const isHidden = profileDropdown.classList.contains('hidden');
                if (isHidden) {
                    profileDropdown.classList.remove('hidden');
                    setTimeout(() => {
                        profileDropdown.classList.remove('opacity-0', 'scale-95');
                    }, 10);
                } else {
                    profileDropdown.classList.add('opacity-0', 'scale-95');
                    setTimeout(() => {
                        profileDropdown.classList.add('hidden');
                    }, 200);
                }
            });

            window.addEventListener('click', () => {
                if (profileDropdown && !profileDropdown.classList.contains('hidden')) {
                    profileDropdown.classList.add('opacity-0', 'scale-95');
                    setTimeout(() => {
                        profileDropdown.classList.add('hidden');
                    }, 200);
                }
            });

            // Auth modal view switching
            document.getElementById('auth-toggle-link').addEventListener('click', () => {
                authView = 'signup';
                updateAuthView();
            });

            forgotPasswordLink.addEventListener('click', () => {
                authView = 'reset';
                updateAuthView();
            });

            backToLoginLink.addEventListener('click', () => {
                authView = 'login';
                updateAuthView();
            });

            // Tab switching logic
            function setupTabs(buttons, contents) {
                buttons.forEach(button => {
                    button.addEventListener('click', () => {
                        buttons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        const tab = button.dataset.tab;
                        contents.forEach(content => {
                            if (content.id.endsWith(tab)) {
                                content.classList.remove('hidden');
                            } else {
                                content.classList.add('hidden');
                            }
                        });
                    });
                });
            }

            const phdTabButtons = document.querySelectorAll('.phd-tab-button');
            if (phdTabButtons.length > 0) {
                const phdTabContents = document.querySelectorAll('.phd-tab-content');
                setupTabs(phdTabButtons, phdTabContents);
            }

            const newsTabButtons = document.querySelectorAll('.news-tab-button');
            if (newsTabButtons.length > 0) {
                const newsTabContents = document.querySelectorAll('.news-tab-content');
                setupTabs(newsTabButtons, newsTabContents);
            }

            // --- Cart Badge Update Logic ---
            updateCartBadge(); // Initial update
            window.addEventListener('cartUpdated', updateCartBadge); // Listen for changes

            // --- Product Button Listeners ---
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const item = {
                        id: button.dataset.id,
                        name: button.dataset.name,
                        price: parseFloat(button.dataset.price),
                        image: button.dataset.image,
                        quantity: 1
                    };
                    addToCart(item);
                    showToast(`${item.name} added to cart!`, 'success');
                });
            });

            document.querySelectorAll('.buy-now-btn').forEach(button => {
                button.addEventListener('click', () => {
                    clearCart(); 
                    const item = {
                        id: button.dataset.id,
                        name: button.dataset.name,
                        price: parseFloat(button.dataset.price),
                        image: button.dataset.image,
                        quantity: 1
                    };
                    addToCart(item);
                    showPage('page-checkout');
                });
            });

            // --- Cart & Checkout Page Listeners ---
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', () => {
                    showPage('page-checkout');
                });
            }

            if(payNowBtn) {
                payNowBtn.addEventListener('click', handlePayment);
            }
        } // end setupUIEventListeners

        function updateAuthView() {
            showMessage('');
            fullNameContainer.classList.add('hidden');
            mobileContainer.classList.add('hidden');
            passwordField.classList.remove('hidden');
            authToggleText.classList.remove('hidden');
            forgotPasswordContainer.classList.add('hidden');
            backToLoginContainer.classList.add('hidden');

            if (authView === 'login') {
                authTitle.textContent = 'Login';
                authActionText.textContent = 'Login';
                forgotPasswordContainer.classList.remove('hidden');
                authToggleText.innerHTML = `Don't have an account? <button id="auth-toggle-link" class="font-medium text-blue-600 hover:text-blue-500">Sign Up</button>`;
                document.getElementById('auth-toggle-link').addEventListener('click', () => { authView = 'signup'; updateAuthView(); });
            } else if (authView === 'signup') {
                authTitle.textContent = 'Create Account';
                authActionText.textContent = 'Sign Up';
                fullNameContainer.classList.remove('hidden');
                mobileContainer.classList.remove('hidden');
                authToggleText.innerHTML = `Already have an account? <button id="auth-toggle-link" class="font-medium text-blue-600 hover:text-blue-500">Login</button>`;
                document.getElementById('auth-toggle-link').addEventListener('click', () => { authView = 'login'; updateAuthView(); });
            } else if (authView === 'reset') {
                authTitle.textContent = 'Reset Password';
                authActionText.textContent = 'Send Reset Link';
                passwordField.classList.add('hidden');
                authToggleText.classList.add('hidden');
                backToLoginContainer.classList.remove('hidden');
                showMessage('Enter your email to receive a password reset link.');
            }
        };
        
        function updateUIForLogin(user) {
            currentUser = user;
            if (user) {
                // Hide desktop and mobile login buttons
                loginBtn.classList.add('hidden');
                mobileLoginBtn.textContent = 'Logged In';
                mobileLoginBtn.disabled = true;
                
                // Show the user profile icon
                userProfile.classList.remove('hidden');
                
                // Show the correct dropdown content
                loggedOutDropdown.classList.add('hidden');
                loggedInDropdown.classList.remove('hidden');

                // Update profile info
                userDisplayName.textContent = user.displayName || user.email;

                if (user.photoURL) {
                    userAvatar.src = user.photoURL;
                    userAvatar.classList.remove('hidden');
                    userIcon.classList.add('hidden');
                } else {
                    userAvatar.classList.add('hidden');
                    userIcon.classList.remove('hidden');
                }

                if (!user.emailVerified) {
                    verificationStatus.classList.remove('hidden');
                } else {
                    verificationStatus.classList.add('hidden');
                }

                // Pre-fill checkout form
                if (shippingForm) {
                     if (user.displayName) document.getElementById('shipping-name').value = user.displayName;
                     if (user.email) document.getElementById('shipping-email').value = user.email;
                }

            } else {
                // Show desktop and mobile login buttons
                loginBtn.classList.remove('hidden');
                mobileLoginBtn.textContent = 'Login / Sign Up';
                mobileLoginBtn.disabled = false;
                
                // Hide profile icon
                userProfile.classList.add('hidden');
                
                // Show the logged-out dropdown content
                loggedOutDropdown.classList.remove('hidden');
                loggedInDropdown.classList.add('hidden');

                userDisplayName.textContent = '';
            }
        };

        function updateCartBadge() {
            if (cartCountBadge) {
                const count = getCartCount();
                cartCountBadge.textContent = count;
                if (count > 0) {
                    cartCountBadge.classList.remove('hidden');
                } else {
                    cartCountBadge.classList.add('hidden'); // Hide if cart is empty
                }
            }
        }

        // --- Firebase Auth Logic ---
        async function initializeAuth() {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    user.reload().then(() => {
                        updateUIForLogin(auth.currentUser);
                    });
                } else {
                    updateUIForLogin(null);
                }
            });

            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase auth initialization error:", error);
            }

            logoutBtn.addEventListener('click', () => {
                signOut(auth).catch((error) => {
                    console.error('Logout Error:', error);
                    showMessage('Failed to logout. Please try again.', 'error');
                });
            });

            resendVerificationBtn.addEventListener('click', () => {
                if (currentUser) {
                    sendEmailVerification(currentUser)
                        .then(() => {
                            showToast('Verification link sent again. Please check your inbox.', 'info');
                        })
                        .catch(error => {
                            showToast('Error sending verification link.', 'error');
                        });
                }
            });

            authActionBtn.addEventListener('click', async () => {
                const fullName = authFullNameInput.value.trim();
                const email = authEmailInput.value.trim();
                const password = authPasswordInput.value;

                if (!email) {
                    showMessage('Please enter your email address.', 'error');
                    return;
                }

                if (authView !== 'reset' && !password) {
                    showMessage('Please enter your password.', 'error');
                    return;
                }
                if (authView === 'signup' && !fullName) {
                    showMessage('Please enter your full name.', 'error');
                    return;
                }
                
                setLoading(authActionBtn, authActionText, authSpinner, true);
                
                if (authView === 'login') {
                    signInWithEmailAndPassword(auth, email, password)
                        .then((userCredential) => {
                            showMessage('Login successful!', 'success');
                            setTimeout(closeModal, 1500);
                        })
                        .catch((error) => showMessage(getFriendlyErrorMessage(error.code), 'error'))
                        .finally(() => setLoading(authActionBtn, authActionText, authSpinner, false));
                } else if (authView === 'signup') {
                    try {
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        await updateProfile(userCredential.user, { displayName: fullName });
                        await sendEmailVerification(userCredential.user);
                        
                        updateUIForLogin(auth.currentUser);

                        showMessage('Account created! A verification link has been sent to your email.', 'success');
                        setTimeout(closeModal, 1500);
                    } catch (error) {
                        showMessage(getFriendlyErrorMessage(error.code), 'error');
                    } finally {
                        setLoading(authActionBtn, authActionText, authSpinner, false);
                    }
                } else if (authView === 'reset') {
                    sendPasswordResetEmail(auth, email)
                        .then(() => showMessage('Password reset link sent! Please check your email.', 'success'))
                        .catch((error) => showMessage(getFriendlyErrorMessage(error.code), 'error'))
                        .finally(() => setLoading(authActionBtn, authActionText, authSpinner, false));
                }
            });

            // --- Profile Picture Upload ---
            avatarUploadInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file || !currentUser) return;

                const storageRef = ref(storage, `profile_pictures/${currentUser.uid}`);
                
                userIcon.classList.add('hidden');
                userAvatar.classList.add('hidden');
                avatarSpinner.classList.remove('hidden');

                uploadBytes(storageRef, file).then(snapshot => {
                    return getDownloadURL(snapshot.ref);
                }).then(downloadURL => {
                    return updateProfile(currentUser, { photoURL: downloadURL });
                }).then(() => {
                    userAvatar.src = currentUser.photoURL;
                    avatarSpinner.classList.add('hidden');
                    userAvatar.classList.remove('hidden');
                    showToast('Profile picture updated!', 'success');
                }).catch(error => {
                    console.error("Error uploading profile picture: ", error);
                    showToast('Failed to update picture.', 'error');
                    avatarSpinner.classList.add('hidden');
                    if (currentUser.photoURL) {
                        userAvatar.classList.remove('hidden');
                    } else {
                        userIcon.classList.remove('hidden');
                    }
                });
            });
        }
        
        // --- Cart Page Logic ---
        function renderCart() {
            const items = getCartItems();
            cartContainer.innerHTML = ''; // Clear existing items

            if (items.length === 0) {
                cartContainer.innerHTML = '<p class="p-8 text-center text-gray-500">Your cart is empty.</p>';
                checkoutBtn.disabled = true;
                checkoutBtn.classList.add('opacity-50', 'cursor-not-allowed');
                cartTotalEl.textContent = '₹0.00';
                return;
            }

            checkoutBtn.disabled = false;
            checkoutBtn.classList.remove('opacity-50', 'cursor-not-allowed');

            items.forEach((item, index) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'flex flex-col md:flex-row items-center justify-between p-6';
                if (index < items.length - 1) {
                    itemEl.classList.add('border-b', 'border-gray-200');
                }

                itemEl.innerHTML = `
                    <div class="flex items-center mb-4 md:mb-0">
                        <img src="${item.image}" alt="${item.name}" class="w-20 h-20 object-cover rounded-lg mr-4">
                        <div>
                            <h3 class="font-bold text-lg text-slate-800">${item.name}</h3>
                            <p class="text-gray-600">₹${item.price.toFixed(2)}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center border rounded-lg">
                            <button class="quantity-change-btn p-2" data-id="${item.id}" data-change="-1">
                                <i class="fas fa-minus text-sm"></i>
                            </button>
                            <input type="number" value="${item.quantity}" min="1" class="w-16 text-center border-l border-r quantity-input" data-id="${item.id}">
                            <button class="quantity-change-btn p-2" data-id="${item.id}" data-change="1">
                                <i class="fas fa-plus text-sm"></i>
                            </button>
                        </div>
                        <p class="text-lg font-semibold w-24 text-right">₹${(item.price * item.quantity).toFixed(2)}</p>
                        <button class="remove-item-btn text-red-500 hover:text-red-700 p-2" data-id="${item.id}">
                            <i class="fas fa-trash-alt text-lg"></i>
                        </button>
                    </div>
                `;
                cartContainer.appendChild(itemEl);
            });

            // Add event listeners for new buttons
            cartContainer.querySelectorAll('.remove-item-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    removeFromCart(btn.dataset.id);
                    renderCart();
                });
            });

            cartContainer.querySelectorAll('.quantity-change-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = btn.dataset.id;
                    const change = parseInt(btn.dataset.change);
                    const currentItem = getCartItems().find(i => i.id === id);
                    updateQuantity(id, currentItem.quantity + change);
                    renderCart();
                });
            });

            cartContainer.querySelectorAll('.quantity-input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const id = input.dataset.id;
                    const newQuantity = parseInt(e.target.value);
                    if (newQuantity) {
                        updateQuantity(id, newQuantity);
                        renderCart();
                    }
                });
            });
            
            cartTotalEl.textContent = `₹${getCartTotal().toFixed(2)}`;
        }

        // --- Checkout Page Logic ---
        function renderCheckoutSummary() {
            const items = getCartItems();
            const total = getCartTotal();

            if (items.length === 0) {
                checkoutSummaryContainer.innerHTML = '<p class="text-gray-500">Your cart is empty.</p>';
                payNowBtn.disabled = true;
                payNowBtn.classList.add('opacity-50');
            } else {
                checkoutSummaryContainer.innerHTML = ''; // Clear
                items.forEach(item => {
                    checkoutSummaryContainer.innerHTML += `
                        <div class="flex justify-between items-center text-sm">
                            <span class="font-medium text-slate-700">${item.name} (x${item.quantity})</span>
                            <span class="text-gray-600">₹${(item.price * item.quantity).toFixed(2)}</span>
                        </div>
                    `;
                });
                checkoutSubtotal.textContent = `₹${total.toFixed(2)}`;
                checkoutTotal.textContent = `₹${total.toFixed(2)}`;
                payNowBtn.disabled = false;
                payNowBtn.classList.remove('opacity-50');
            }

            // Pre-fill form if user is logged in
            if (currentUser) {
                if (currentUser.displayName) document.getElementById('shipping-name').value = currentUser.displayName;
                if (currentUser.email) document.getElementById('shipping-email').value = currentUser.email;
            }
        }

        function handlePayment() {
            // Check login
            if (!currentUser || currentUser.isAnonymous) {
                showToast('Please log in to complete your purchase.', 'error');
                openModal();
                return;
            }
            
            // Check email verification
            if (!currentUser.emailVerified) {
                showToast('Please verify your email before purchasing.', 'error');
                return;
            }

            // Check form validity
            if (!shippingForm.checkValidity()) {
                shippingForm.reportValidity();
                showToast('Please fill in all required shipping details.', 'error');
                return;
            }

            // All checks passed, initiate payment
            const totalAmount = getCartTotal();
            const options = {
                // IMPORTANT: Replace with your REAL Razorpay Key ID
                key: "YOUR_RAZORPAY_KEY_ID_HERE", 
                amount: totalAmount * 100,
                currency: "INR",
                name: "Elite Science Institute",
                description: "Payment for ESI Courses and Merchandise",
                image: "data:image/png;base64,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",
                handler: function (response) {
                    console.log(response);
                    showToast(`Payment successful! Payment ID: ${response.razorpay_payment_id}`, 'success');
                    clearCart();
                    // Redirect to home after successful payment
                    setTimeout(() => {
                        showPage('page-home');
                    }, 3000);
                },
                prefill: {
                    name: document.getElementById('shipping-name').value,
                    email: document.getElementById('shipping-email').value,
                    contact: document.getElementById('shipping-phone').value
                },
                notes: {
                    address: document.getElementById('shipping-address').value,
                    city: document.getElementById('shipping-city').value,
                    state: document.getElementById('shipping-state').value,
                    zip: document.getElementById('shipping-zip').value,
                    userId: currentUser.uid
                },
                theme: {
                    color: "#1d4ed8"
                }
            };
            
            const rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function (response){
                console.log(response);
                showToast(`Payment failed: ${response.error.description}`, 'error');
            });
            rzp1.open();
        }
        
        // --- Helper Functions ---
        function showMessage(msg, type = 'info') {
            authMessage.textContent = msg;
            authMessage.className = 'mt-4 text-center text-sm'; // reset classes
            switch (type) {
                case 'success':
                    authMessage.classList.add('text-green-600');
                    break;
                case 'error':
                    authMessage.classList.add('text-red-600');
                    break;
                default:
                    authMessage.classList.add('text-gray-600');
            }
        }
        
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = 'toast-notification fixed bottom-5 right-5 text-white py-3 px-6 rounded-lg shadow-lg transform translate-y-24 opacity-0 pointer-events-none z-50';
            
            if (type === 'success') {
                toast.classList.add('bg-green-600');
            } else if(type === 'info') {
                toast.classList.add('bg-blue-600');
            }
            else {
                toast.classList.add('bg-red-600');
            }
            
            toast.classList.remove('translate-y-24', 'opacity-0', 'pointer-events-none');
            
            setTimeout(() => {
                toast.classList.add('translate-y-24', 'opacity-0');
                setTimeout(() => {
                    toast.classList.add('pointer-events-none');
                }, 300);
            }, 5000); // Hide after 5 seconds
        }
        
        function setLoading(button, textEl, spinnerEl, isLoading) {
            if (isLoading) {
                button.disabled = true;
                textEl.style.opacity = '0';
                spinnerEl.classList.remove('hidden');
            } else {
                button.disabled = false;
                textEl.style.opacity = '1';
                spinnerEl.classList.add('hidden');
            }
        }

        function resetModalUI() {
            authView = 'login';
            updateAuthView();
            authFullNameInput.value = '';
            authEmailInput.value = '';
            authMobileInput.value = '';
            authPasswordInput.value = '';
            showMessage('');
        }
        
        function getFriendlyErrorMessage(errorCode) {
            switch (errorCode) {
                case 'auth/invalid-email':
                    return 'Please enter a valid email address.';
                case 'auth/user-not-found':
                case 'auth/invalid-credential':
                    return 'Invalid email or password.';
                case 'auth/wrong-password':
                    return 'Invalid email or password.';
                case 'auth/email-already-in-use':
                    return 'An account with this email already exists.';
                case 'auth/weak-password':
                    return 'Password should be at least 6 characters long.';
                default:
                    console.error("Firebase Auth Error:", errorCode);
                    return 'An unknown error occurred. Please try again.';
            }
        }

        // --- App Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            assignDOMElements();
            setupUIEventListeners();
            initializeAuth();
            showPage('page-home'); // Show home page on load
        });

    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            color: #374151; /* text-gray-700 */
        }
        .hero-section {
            background-image: linear-gradient(rgba(17, 24, 39, 0.7), rgba(17, 24, 39, 0.7)), url('https://placehold.co/1600x800/1f2937/ffffff?text=Future+of+Science');
            background-size: cover;
            background-position: center;
        }
        .course-card, .news-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #e5e7eb; /* border-gray-200 */
        }
        .course-card:hover, .news-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .modal-backdrop {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
        }
        .toast-notification {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        .tab-button {
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        .tab-button.active {
            color: #1d4ed8; /* text-blue-700 */
            border-bottom-color: #1d4ed8; /* border-blue-700 */
        }
        .section-title {
            color: #111827; /* text-gray-900 */
        }
        .section-subtitle {
            color: #4b5563; /* text-gray-600 */
        }
        .buy-now-btn-gold {
            background-color: #ca8a04; /* amber-500 */
        }
        .buy-now-btn-gold:hover {
            background-color: #a16207; /* amber-600 */
        }
        .profile-dropdown-item {
            transition: background-color 0.2s ease-in-out;
        }
        .profile-dropdown-item:hover {
            background-color: #f3f4f6; /* gray-100 */
        }
        #profile-dropdown {
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        /* Sub-navigation dropdown */
        .sub-nav-link {
            @apply block px-4 py-2 text-sm text-gray-700 hover:bg-amber-100;
        }
    </style>
</head>
<body class="bg-slate-50">

    <!-- Header & Navigation -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <!-- Top bar with Logo and Auth -->
        <nav class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <a href="#" onclick="showPage('page-home')" class="text-2xl font-bold text-slate-800 flex items-center">
                    <img src="data:image/png;base64,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" alt="Elite Science Institute Logo" class="h-10 w-10 mr-2">
                    <span>Elite Science Institute</span>
                </a>
                
                <div class="flex items-center space-x-6">
                    <!-- Cart Icon -->
                    <a href="#" onclick="showPage('page-cart')" class="text-gray-600 hover:text-amber-600 font-medium transition duration-300 relative">
                        <i class="fas fa-shopping-cart text-2xl"></i>
                        <span id="cart-count-badge" class="absolute -top-2 -right-3 bg-red-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
                    </a>

                    <!-- Profile / Auth -->
                    <div class="relative">
                        <div id="user-profile-trigger" class="flex items-center cursor-pointer space-x-2">
                            <div class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden border-2 border-slate-300" id="avatar-container">
                                <img id="user-avatar" class="w-full h-full object-cover hidden" alt="User Avatar">
                                <i id="user-icon" class="fas fa-user text-xl text-slate-500"></i>
                                <div id="avatar-spinner" class="hidden w-6 h-6 border-4 border-t-blue-500 border-gray-200 rounded-full animate-spin"></div>
                            </div>
                            <span id="user-display-name" class="text-sm text-slate-700 font-semibold hidden md:block max-w-[120px] truncate">Profile</span>
                        </div>
                        
                        <!-- Profile Dropdown -->
                        <div id="profile-dropdown" class="absolute top-full right-0 mt-2 w-56 bg-white rounded-md shadow-lg py-1 z-20 hidden opacity-0 transform scale-95">
                            
                            <!-- Logged-in State -->
                            <div id="logged-in-dropdown" class="hidden">
                                <div id="verification-status" class="px-4 py-2 border-b hidden">
                                    <p class="text-xs text-yellow-800 bg-yellow-100 p-2 rounded-md">Email not verified.</p>
                                    <button id="resend-verification-btn" class="text-xs text-blue-600 hover:underline mt-1">Resend link</button>
                                </div>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 profile-dropdown-item">Your Info</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 profile-dropdown-item">Your Orders</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 profile-dropdown-item">ESI Membership</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 profile-dropdown-item">Rewards</a>
                                <label for="avatar-upload" class="block px-4 py-2 text-sm text-gray-700 profile-dropdown-item cursor-pointer">Change Picture</label>
                                <input type="file" id="avatar-upload" class="hidden" accept="image/*">
                                <div class="border-t border-gray-100"></div>
                                <button id="logout-btn" class="w-full text-left px-4 py-2 text-sm text-red-600 profile-dropdown-item">Logout</button>
                            </div>

                            <!-- Logged-out State -->
                            <div id="logged-out-dropdown">
                                <button id="profile-login-btn" class="w-full text-left px-4 py-2 text-sm text-gray-700 profile-dropdown-item">
                                    Login / Sign Up
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Desktop-only Auth Button (Fallback) -->
                    <button id="login-btn" class="hidden bg-blue-700 text-white px-5 py-2.5 rounded-lg font-semibold hover:bg-blue-800 transition-all duration-300 md:flex items-center space-x-2 shadow-sm hover:shadow-md">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Login / Sign Up</span>
                    </button>
                    <div id="user-profile" class="hidden relative">
                        <!-- This div is kept for the auth logic to target but is replaced by the new dropdown -->
                    </div>

                    <!-- Mobile Menu Button -->
                    <div class="md:hidden">
                        <button id="mobile-menu-button" class="text-slate-700 focus:outline-none">
                            <i class="fas fa-bars text-2xl"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Golden Navigation Strip -->
        <div class="bg-amber-500 shadow-md">
            <div class="container mx-auto px-6 hidden md:flex justify-center items-center space-x-4 h-14">
                
                <a href="#" onclick="showPage('page-home')" class="text-white hover:bg-amber-600 px-4 py-4 font-semibold transition duration-300">Home</a>

                <!-- Our Courses Dropdown -->
                <div class="relative group">
                    <button class="text-white hover:bg-amber-600 px-4 py-4 font-semibold transition duration-300 flex items-center">
                        <span>Our Courses</span>
                        <i class="fas fa-chevron-down text-xs ml-2"></i>
                    </button>
                    <div class="absolute top-full left-0 mt-0 w-48 bg-white rounded-md shadow-lg py-1 z-20 hidden group-hover:block">
                        <a href="#" onclick="showPage('page-courses')" class="sub-nav-link">CSIR NET</a>
                        <a href="#" onclick="showPage('page-courses')" class="sub-nav-link">GATE Life science</a>
                        <a href="#" onclick="showPage('page-courses')" class="sub-nav-link">IIT-JAM</a>
                    </div>
                </div>

                <!-- Test Series Dropdown -->
                <div class="relative group">
                    <button class="text-white hover:bg-amber-600 px-4 py-4 font-semibold transition duration-300 flex items-center">
                        <span>Test Series</span>
                        <i class="fas fa-chevron-down text-xs ml-2"></i>
                    </button>
                    <div class="absolute top-full left-0 mt-0 w-48 bg-white rounded-md shadow-lg py-1 z-20 hidden group-hover:block">
                        <a href="#" onclick="showPage('page-test-series')" class="sub-nav-link">All India Mock Test</a>
                        <a href="#" onclick="showPage('page-test-series')" class="sub-nav-link">Topic-wise Tests</a>
                        <a href="#" onclick="showPage('page-test-series')" class="sub-nav-link">Previous Year Papers</a>
                    </div>
                </div>

                <!-- Merchandise Dropdown -->
                <div class="relative group">
                    <button class="text-white hover:bg-amber-600 px-4 py-4 font-semibold transition duration-300 flex items-center">
                        <span>Merchandise</span>
                        <i class="fas fa-chevron-down text-xs ml-2"></i>
                    </button>
                    <div class="absolute top-full left-0 mt-0 w-48 bg-white rounded-md shadow-lg py-1 z-20 hidden group-hover:block">
                        <a href="#" onclick="showPage('page-merchandise')" class="sub-nav-link">T-Shirts</a>
                        <a href="#" onclick="showPage('page-merchandise')" class="sub-nav-link">Mugs</a>
                    </div>
                </div>

                <!-- PhD Positions Dropdown -->
                <div class="relative group">
                    <button class="text-white hover:bg-amber-600 px-4 py-4 font-semibold transition duration-300 flex items-center">
                        <span>PhD Positions</span>
                        <i class="fas fa-chevron-down text-xs ml-2"></i>
                    </button>
                    <div class="absolute top-full left-0 mt-0 w-48 bg-white rounded-md shadow-lg py-1 z-20 hidden group-hover:block">
                        <a href="#" onclick="showPage('page-phd')" class="sub-nav-link">India</a>
                        <a href="#" onclick="showPage('page-phd')" class="sub-nav-link">Abroad</a>
                    </div>
                </div>

                <!-- Research News Dropdown -->
                <div class="relative group">
                    <button class="text-white hover:bg-amber-600 px-4 py-4 font-semibold transition duration-300 flex items-center">
                        <span>Research News</span>
                        <i class="fas fa-chevron-down text-xs ml-2"></i>
                    </button>
                    <div class="absolute top-full left-0 mt-0 w-48 bg-white rounded-md shadow-lg py-1 z-20 hidden group-hover:block">
                        <a href="#" onclick="showPage('page-news')" class="sub-nav-link">Daily</a>
                        <a href="#" onclick="showPage('page-news')" class="sub-nav-link">Weekly</a>
                        <a href="#" onclick="showPage('page-news')" class="sub-nav-link">Monthly</a>
                    </div>
                </div>

            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden border-t">
            <a href="#" onclick="showPage('page-home')" class="block py-2.5 px-4 text-base text-slate-700 hover:bg-slate-100 rounded-md">Home</a>
            <a href="#" onclick="showPage('page-courses')" class="block py-2.5 px-4 text-base text-slate-700 hover:bg-slate-100 rounded-md">Our Courses</a>
            <a href="#" onclick="showPage('page-test-series')" class="block py-2.5 px-4 text-base text-slate-700 hover:bg-slate-100 rounded-md">Test Series</a>
            <a href="#" onclick="showPage('page-merchandise')" class="block py-2.5 px-4 text-base text-slate-700 hover:bg-slate-100 rounded-md">Merchandise</a>
            <a href="#" onclick="showPage('page-phd')" class="block py-2.5 px-4 text-base text-slate-700 hover:bg-slate-100 rounded-md">PhD Positions</a>
            <a href="#" onclick="showPage('page-news')" class="block py-2.5 px-4 text-base text-slate-700 hover:bg-slate-100 rounded-md">Research News</a>
            <button id="mobile-login-btn" class="w-full mt-3 bg-blue-700 text-white px-4 py-3 rounded-lg font-semibold hover:bg-blue-800 transition duration-300">Login / Sign Up</button>
        </div>
    </header>

    <!-- Main Content -->
    <main>

        <!-- PAGE: Home -->
        <div id="page-home" class="page-content">
            <!-- Hero Section -->
            <section class="hero-section text-white">
                <div class="container mx-auto px-6 py-32 md:py-48 text-center">
                    <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight mb-4">Shaping the Future of Science Professionals</h1>
                    <p class="text-lg md:text-xl text-slate-200 mb-8 max-w-3xl mx-auto">Your journey to a successful career in life sciences and biotechnology begins here. Join Elite Science Institute to achieve your academic goals.</p>
                    <a href="#" onclick="showPage('page-courses')" class="bg-amber-500 text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-amber-600 transition duration-300 transform hover:scale-105 shadow-lg">Explore Our Courses</a>
                </div>
            </section>

            <!-- About Us Section -->
            <section id="about" class="py-20 md:py-24 bg-white">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16">
                        <h2 class="text-3xl md:text-4xl font-bold section-title">About Elite Science Institute</h2>
                        <p class="section-subtitle mt-4 max-w-2xl mx-auto text-lg">Pioneering excellence in life science coaching since 2005.</p>
                    </div>
                    <div class="flex flex-col md:flex-row items-center gap-12">
                        <div class="md:w-1/2">
                            <img src="https://placehold.co/600x400/e2e8f0/334155?text=Our+Mission" alt="About Us Image" class="rounded-xl shadow-xl w-full">
                        </div>
                        <div class="md:w-1/2">
                            <h3 class="text-2xl font-semibold text-slate-800 mb-4">Our Vision & Mission</h3>
                            <p class="text-lg mb-4 leading-relaxed">
                                Elite Science Institute was founded with the mission to provide unparalleled coaching for students aspiring to excel in competitive exams like CSIR-UGC-NET/JRF, DBT-JRF, ICMR-JRF, and IIT-JAM. We believe in building a strong conceptual foundation.
                            </p>
                            <p class="text-lg leading-relaxed">
                                Our vision is to be the most trusted name in life science education, known for our dedicated faculty, comprehensive study material, and a proven track record of success. We are committed to nurturing the scientific minds of tomorrow.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Courses Section (Home) -->
            <section id="courses-home" class="py-20 md:py-24 bg-slate-50">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16">
                        <h2 class="text-3xl md:text-4xl font-bold section-title">Our Premier Courses</h2>
                        <p class="section-subtitle mt-4 max-w-2xl mx-auto text-lg">Comprehensive programs designed for guaranteed success.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        
                        <!-- Course Card 1 -->
                        <div class="course-card bg-white rounded-xl shadow-lg overflow-hidden flex flex-col">
                            <img src="https://placehold.co/400x250/3b82f6/ffffff?text=CSIR-UGC+NET/JRF"
